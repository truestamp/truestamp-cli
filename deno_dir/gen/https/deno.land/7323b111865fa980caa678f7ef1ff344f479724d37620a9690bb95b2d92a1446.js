import { RawBinary } from "../binary.ts";
import { digestLength } from "../hash.ts";
import { emsa_pss_encode, emsa_pss_verify } from "./emsa_pss.ts";
import { i2osp, os2ip } from "./primitives.ts";
import { rsaep } from "./rsa_internal.ts";
export function rsassa_pss_sign(key, m, algorithm) {
    if (!key.d)
        throw "Invalid RSA Key";
    const hLen = digestLength(algorithm);
    let em = emsa_pss_encode(m, key.length * 8 - 1, hLen, algorithm);
    return new RawBinary(i2osp(rsaep(key.n, key.d, os2ip(em)), key.length));
}
export function rsassa_pss_verify(key, m, signature, algorithm) {
    if (!key.e)
        throw "Invalid RSA Key";
    const hLen = digestLength(algorithm);
    const em = i2osp(rsaep(key.n, key.e, os2ip(signature)), key.length);
    return emsa_pss_verify(m, em, key.length * 8 - 1, hLen, algorithm);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnNhc3NhX3Bzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJzYXNzYV9wc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN6QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRTFDLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRzFDLE1BQU0sVUFBVSxlQUFlLENBQzdCLEdBQVcsRUFDWCxDQUFhLEVBQ2IsU0FBMkI7SUFFM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQUUsTUFBTSxpQkFBaUIsQ0FBQztJQUVwQyxNQUFNLElBQUksR0FBRyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDckMsSUFBSSxFQUFFLEdBQUcsZUFBZSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ2pFLE9BQU8sSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDMUUsQ0FBQztBQUVELE1BQU0sVUFBVSxpQkFBaUIsQ0FDL0IsR0FBVyxFQUNYLENBQWEsRUFDYixTQUFxQixFQUNyQixTQUEyQjtJQUUzQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFBRSxNQUFNLGlCQUFpQixDQUFDO0lBRXBDLE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEUsT0FBTyxlQUFlLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ3JFLENBQUMifQ==